<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>FLV Simple Test</title>
    <style>
        body { font-family: Arial; background: #222; color: white; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .section { background: #333; padding: 20px; margin: 10px 0; border-radius: 8px; }
        #video { width: 100%; height: 400px; background: black; }
        .status { margin: 10px 0; padding: 10px; background: #444; border-radius: 4px; }
        .controls button { margin-right: 10px; padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        .controls button:hover { background: #0056b3; }
    </style>
    <script src="flv.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>FLV Simple Test</h1>
        
        <div class="section">
            <div class="controls">
                <button onclick="testPlay()">测试播放</button>
                <button onclick="testStop()">停止播放</button>
            </div>
            <video id="video" controls autoplay></video>
            <div id="status" class="status">状态: 等待操作</div>
        </div>
    </div>

    <script>
        let player = null;
        
        function updateStatus(message) {
            document.getElementById('status').textContent = '状态: ' + message;
        }
        
        function testPlay() {
            updateStatus('正在初始化播放器...');
            
            if (!flvjs.isSupported()) {
                updateStatus('浏览器不支持 FLV 播放');
                return;
            }
            
            if (player) {
                player.destroy();
                player = null;
            }
            
            try {
                player = flvjs.createPlayer({
                    type: 'flv',
                    url: 'http://localhost:8080/live/stream.flv'
                });
                
                player.attachMediaElement(document.getElementById('video'));
                player.load();
                
                player.on(flvjs.Events.ERROR, function (errType, errDetail) {
                    updateStatus('播放错误: ' + errType + ' - ' + errDetail);
                    console.error('FLV Player Error:', errType, errDetail);
                });
                
                player.on(flvjs.Events.LOADING_COMPLETE, function () {
                    updateStatus('加载完成');
                });
                
                player.on(flvjs.Events.METADATA_ARRIVED, function () {
                    updateStatus('元数据已到达');
                });
                
                player.on(flvjs.Events.RENDERED, function () {
                    updateStatus('视频已渲染');
                });
                
                player.play();
                updateStatus('正在播放...');
                
            } catch (error) {
                updateStatus('播放器初始化失败: ' + error.message);
                console.error('Player Error:', error);
            }
        }
        
        function testStop() {
            if (player) {
                player.pause();
                player.unload();
                player.detachMediaElement();
                player.destroy();
                player = null;
            }
            updateStatus('播放已停止');
        }
    </script>
</body>
</html>